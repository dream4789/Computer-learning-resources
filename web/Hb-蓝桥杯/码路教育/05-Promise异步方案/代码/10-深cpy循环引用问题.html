<!-- <script>
    let obj = { name: "wc", age: 18 };
    obj.xxx = obj;
    console.log(obj);

    // newObj = obj;   浅copy

    // 深copy  obj
    //  newObj = {name:"wc",age:18}

    // obj.xxx = 123         obj.xxx = {a:1}           obj.xxx = obj;
    // newObj.xxx = 123      newObj.xxx = {a:1}        newObj.xxx

    // 如果一个对象copy过了，不需要copy
    // 可以把copy过的对象，放到weakmap中，weakmap中是弱引用
</script> -->

<script>
    // let weakMap = new WeakMap();  
    // RangeError: Maximum call stack size exceeded  爆栈了
    function deepClone(target, weakMap = new WeakMap()) {
        if (target == null) return target;
        if (target instanceof Date) return new Date(target)
        if (target instanceof RegExp) return new RegExp(target)
        // ....
        if (typeof target !== "object") return target

        if (weakMap.get(target)) {
            return weakMap.get(target)
        }

        let cloneTarget = new target.constructor;

        weakMap.set(target, cloneTarget)

        for (let key in target) {
            if (target.hasOwnProperty(key)) {
                cloneTarget[key] = deepClone(target[key], weakMap);
            }
        }
        return cloneTarget;
    }
    let obj = { name: "wc" };
    obj.xxx = obj;
    let newObj = deepClone(obj);
    console.log(newObj);
</script>