<!DOCTYPE html>
<html style="height: 100%">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>粒粒皆辛苦</title>
	<script type="text/javascript" src="./js/echarts.min.js"></script>
	<script src="./js/axios.min.js"></script>
</head>

<body style="height: 100%; margin: 0; overflow: hidden">
	<div id="container" style="height: 80%; width: 80%; margin: 5% auto"></div>
	<script>
		var dom = document.getElementById("container");
		var option;
		var myChart = echarts.init(dom, null, {
			renderer: "canvas",
			useDirtyRect: false,
		});
		let initCharts = () => {
			option = {
				title: {
					text: "近五年 x 市粮食总产量分布以及 2022 年粮食产量比例",
					subtext: "单位（万吨）",
				},
				dataset: {
					//source -> 图表显示所需的数据格式（饼形图和折线图共用），请勿手动修改此行
					source: [
						["全部", "2017", "2018", "2019", "2020", "2021", "2022"],
						["小麦", 1, 1, 1, 1, 1, 1],
						["大豆", 9, 9, 9, 9, 9, 9],
						["马铃薯", 13, 13, 13, 13, 13, 13],
						["玉米", 23, 23, 23, 23, 23, 23],
					],
				},
				xAxis: {
					type: "category"
				},
				yAxis: {
					gridIndex: 0
				},
				grid: {
					top: "55%"
				},
				series: [{
					type: "line",
					seriesLayoutBy: "row",
				},
				{
					type: "line",
					seriesLayoutBy: "row",
				},
				{
					type: "line",
					seriesLayoutBy: "row",
				},
				{
					type: "line",
					seriesLayoutBy: "row",
				},
				{
					type: "pie",
					id: "pie",
					radius: "30%",
					center: ["50%", "25%"],
					label: {
						// 2022 数据的百分比
						formatter: "{b} {@2022} ({d}%)",
					},
					encode: {
						itemName: "全部",
						value: "2022",
						tooltip: "2022",
					},
				},
				],
			};
			if (option && typeof option === "object") {
				// myChart.setOption -> 设置 echarts 数据的方法
				myChart.setOption(option);
			}
			window.addEventListener("resize", myChart.resize);
		};
		initCharts();

		// TODO: 待补充代码
		// let ans = [
		// 	[],
		// 	[],
		// 	[],
		// 	[]
		// ]

		// axios.get('./data.json').then(res => {
		// 		console.log(res.data.data);
		// 		let data = res.data.data;

		// 		// let year = Object.keys(data);
		// 		// console.log(year);

		// 		// let cla = Object.keys(Object.values(data)[0]);
		// 		// console.log(cla);

		// 		for (let item in data) {
		// 			// console.log(data[item])

		// 			ans[0].push(data[item].wheat);
		// 			ans[1].push(data[item].soybean);
		// 			ans[2].push(data[item].potato);
		// 			ans[3].push(data[item].corn);
		// 		}

		// 		// console.log(ans)
		// 		// console.log(option.dataset.source)

		// 		let len = option.dataset.source[0].length
		// 		// console.log(len)

		// 		// 一次
		// 		// console.log(option.dataset.source[1].splice(1, len-1))
		// 		// option.dataset.source[1] = option.dataset.source[1].concat(ans[0]);

		// 		// 循环多次
		// 		for (let i = 1; i < option.dataset.source.length; i++) {
		// 			option.dataset.source[i].splice(1, len - 1)
		// 			option.dataset.source[i] = option.dataset.source[i].concat(ans[i - 1]);
		// 		}
		// 		// console.log(option.dataset.source)
		// 		myChart.setOption(option);

		// 	})

		// axios.get('./data.json').then(res => {
		// 		let data = res.data.data;
		// 		for (let item in data) {
		// 			ans[0].push(data[item].wheat);
		// 			ans[1].push(data[item].soybean);
		// 			ans[2].push(data[item].potato);
		// 			ans[3].push(data[item].corn);
		// 		}
		// 		let arr = option.dataset.source;
		// 		let len = arr[0].length
		// 		for (let i = 1; i < arr.length; i++) {
		// 			arr[i].splice(1, len - 1)
		// 			arr[i] = arr[i].concat(ans[i - 1]);
		// 		}
		// 		myChart.setOption(option);
		// 	})


		// axios.get('./data.json').then(res => {
		// 		let data = res.data.data;
		// 		let arr = option.dataset.source;
		// 		let i = 0;
		// 		for (let item in data) {
		// 			arr[1].splice(++i, 1, data[item].wheat);
		// 			arr[2].splice(i, 1, data[item].soybean);
		// 			arr[3].splice(i, 1, data[item].potato);
		// 			arr[4].splice(i, 1, data[item].corn);
		// 		}
		// 		myChart.setOption(option);
		// 	})

		// TODO: 待补充代码
		// axios.get('./data.json').then(res => {
		// 	let data = res.data.data;
		// 	let arr = [
		// 		["全部", "2017", "2018", "2019", "2020", "2021", "2022"],
		// 		["小麦"],
		// 		["大豆"],
		// 		["马铃薯"],
		// 		["玉米"],
		// 	]
		// 	for (let item in data) {
		// 		arr[1].push(data[item].wheat);
		// 		arr[2].push(data[item].soybean);
		// 		arr[3].push(data[item].potato);
		// 		arr[4].push(data[item].corn);
		// 	}
		// 	option.dataset.source = arr;
		// 	myChart.setOption(option);
		// })

		// TODO: 待补充代码
		axios.get('./data.json').then((res) => {
			let arr = option.dataset.source;
			var k = 0;
			let data = res.data.data
			for (let i in data) {
				arr[1][++k] = data[i].wheat
				arr[2][k] = data[i].soybean
				arr[3][k] = data[i].potato
				arr[4][k] = data[i].corn
			}
			console.log(arr)
			myChart.setOption(option);
		})
	</script>
</body>

</html>